#  Kordia - Music App

Kordia es una aplicaci贸n web moderna dise帽ada para buscar, transmitir y descargar m煤sica de YouTube con soporte completo para uso sin conexi贸n (PWA).

---

> [!CAUTION]
> Querido Programador:  \
> Cuando escrib铆 este c贸digo, s贸lo Dios y yo \
> sab铆amos c贸mo funcionaba. Ahora, s贸lo Dios lo sabe. \
> As铆 que si est谩 tratando de 'optimizar' \
> esta rutina y fracasa (seguramente), \
> por favor, incremente el siguiente contador: \
> como advertencia para el siguiente colega \
> 
> Bugs encontrados: 3 \
> Horas perdidas: 912 \
>  :)

##  Instalaci贸n en PC (Manual)

### 1. Requisitos Previos
- **Node.js** (v16 o superior)
- **Python** (v3.8 o superior)
- **FFmpeg** (Se gestiona autom谩ticamente en el backend v铆a `static-ffmpeg`)

### 2. Configuraci贸n del Frontend (npm / pnpm)
1. Entra al directorio del frontend:
   ```bash
   cd Kordia_Frontend
   ```
2. Instala las dependencias:
   ```bash
   npm install
   ```
3. Configura el archivo `.env`:
   ```bash
   cp .env.example .env
   ```
   Aseg煤rate de que `VITE_API_URL` apunte a tu backend (ej. `http://localhost:8000`).
4. Inicia el desarrollo:
   ```bash
   npm run build
   ```
   *El frontend correr谩 en el backend*

### 3. Configuraci贸n del Backend
1. Entra al directorio del backend:
   ```bash
   cd Kordia_backend
   ```
2. Crea un entorno virtual e inst谩lalo:
   ```bash
   python -m venv venv
   source venv/bin/activate  # En Linux/Mac
   venv\Scripts\activate     # En Windows
   ```
3. Instala las dependencias:
   ```bash
   pip install -r requirements.txt
   ```
4. Inicia el servidor:
   ```bash
   python -m app.main
   ```
   *El backend correr谩 en `http://localhost:8000`*

---

##  Instalaci贸n con Docker (Windows, Linux, Mac)

Docker es la forma m谩s sencilla de ejecutar Kordia en cualquier sistema operativo.

1. Aseg煤rate de tener **Docker** y **Docker Compose** instalados.
2. Navega a la carpeta del proyecto y ejecuta:
   ```bash
   docker-compose -f docker/docker-compose.yml up -d
   ```
3. La aplicaci贸n estar谩 disponible en `https://tu-ip-local:8000`.

> [!IMPORTANT]
> Para que la PWA funcione correctamente en m贸viles, Docker utiliza **mkcert** para generar certificados SSL autom谩ticos. Aseg煤rate de configurar la variable `MKCERT_DOMAINS` en el `docker-compose.yml` con la IP local de tu PC.

---

##  Instalaci贸n PWA en M贸viles (Android / iOS)

Para que Kordia funcione como una aplicaci贸n nativa en tu m贸vil (PWA) y soporte descargas offline, sigue estos pasos:

### 1. Acceso seguro (HTTPS)
Las PWA requieren **HTTPS** por seguridad. 
- Si usas **Docker**: La aplicaci贸n ya sirve HTTPS en el puerto `8000`.
- Si usas la instalaci贸n **Manual**: Deber谩s usar un t煤nel (como Cloudflare Tunnel o Ngrok) o un proxy inverso (como Nginx) para habilitar HTTPS.

### 2. Pasos para instalar:
1. Desde tu m贸vil, abre el navegador (Chrome en Android, Safari en iOS).
2. Ingresa la direcci贸n IP de tu PC con HTTPS (ej: `https://192.168.1.XX:8000`).
3. **En Android (Chrome):** Toca los tres puntos `` y selecciona **"Instalar aplicaci贸n"** o **"Agregar a la pantalla de inicio"**.
4. **En iOS (Safari):** Toca el bot贸n de compartir `` y selecciona **"A帽adir a la pantalla de inicio"**.

### 3. Soluci贸n al error "Conexi贸n No Segura" (Muy Importante)
Incluso con HTTPS activado v铆a Docker, el m贸vil marcar谩 la conexi贸n como **"No Segura"** porque el certificado es de desarrollo (auto-firmado). Esto **bloquear谩 los Service Workers** y no podr谩s descargar m煤sica.

Tienes dos formas de solucionarlo:

#### Opci贸n A: Instalar el certificado en tu m贸vil (Recomendado)
Para que el m贸vil conf铆e en la conexi贸n y funcionen todas las funciones:
1. Localiza o extrae el archivo `rootCA.pem` que genera mkcert. 
   - **Si usas la instalaci贸n Manual:**
     - **En Windows:** Presiona `Win + R`, escribe `%LocalAppData%\mkcert` y pulsa Enter.
     - **En Linux:** Busca en `~/.local/share/mkcert`.
     - **En Mac:** Busca en `~/Library/Application Support/mkcert`.
   - **Si usas Docker:**
     El certificado se genera dentro del contenedor. Puedes extraerlo a tu PC con este comando:
     ```bash
     docker exec kordia mkcert -CAROOT # Para ver la ruta (opcional)
     docker cp kordia:/root/.local/share/mkcert/rootCA.pem ./rootCA.pem
     ```
     *Nota: El archivo `rootCA.pem` aparecer谩 en la carpeta desde donde lances el comando.*
     
2. Env铆a ese archivo a tu m贸vil.
3. **En Android:** Ajustes > Seguridad > Cifrado y credenciales > Instalar desde almacenamiento > Certificado de CA.
4. **En iOS:** Instala el perfil y luego ve a Ajustes > General > Informaci贸n > Ajustes de confianza de certificados y activa el "rootCA".

#### Opci贸n B: Bypass en Chrome (Solo Android/Desktop)
Si no quieres instalar cerficados, puedes forzar a Chrome a tratar tu IP como segura:
1. Abre `chrome://flags/#unsafely-treat-insecure-origin-as-secure` en Chrome.
2. Activa la opci贸n (**Enabled**).
3. En el cuadro de texto, pega la URL de tu app (ej: `https://192.168.1.XX:8000`).
4. Reinicia Chrome.

### 4. 隆Listo!
Ahora puedes abrir Kordia desde tu men煤 de aplicaciones, buscar canciones y darle al bot贸n de **descargar** para escucharlas sin internet.


---

## 锔 Configuraci贸n til (Variables de Entorno)

| Variable | Prop贸sito |
|----------|-----------|
| `CORS_ORIGINS` | Dominios que pueden acceder a la API (usa `*` para desarrollo). |
| `DATA_DIR` | Donde se guardan las canciones y la base de datos. |
| `MKCERT_DOMAINS` | IPs o dominios para los que se generar谩 el certificado SSL. |

---
*Hecho con わ para los amantes de la m煤sica.*