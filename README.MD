#  Kordia - Music App

Kordia es una aplicaci贸n web moderna dise帽ada para buscar, transmitir y descargar m煤sica de YouTube con soporte completo para uso sin conexi贸n (PWA).

---

> [!CAUTION]
> Querido Programador:  \
> Cuando escrib铆 este c贸digo, s贸lo Dios y yo \
> sab铆amos c贸mo funcionaba. Ahora, s贸lo Dios lo sabe. \
> As铆 que si est谩 tratando de 'optimizar' \
> esta rutina y fracasa (seguramente), \
> por favor, incremente el siguiente contador: \
> como advertencia para el siguiente colega \
> 
> Bugs encontrados: 3 \
> Horas perdidas: 912 \
>  :)

##  Instalaci贸n en PC (Manual)

### 1. Requisitos Previos
- **Node.js** (v16 o superior)
- **Python** (v3.8 o superior)
- **FFmpeg** (Se gestiona autom谩ticamente en el backend v铆a `static-ffmpeg`)

### 2. Configuraci贸n del Frontend (npm / pnpm)
1. Entra al directorio del frontend:
   ```bash
   cd Kordia_Frontend
   ```
2. Instala las dependencias:
   ```bash
   npm install
   ```
3. Configura el archivo `.env`:
   ```bash
   cp .env.example .env
   ```
   Aseg煤rate de que `VITE_API_URL` apunte a tu backend (ej. `http://localhost:8000`).
4. Inicia el desarrollo:
   ```bash
   npm run build
   ```
   *El frontend correr谩 en el backend*

### 3. Configuraci贸n del Backend
1. Entra al directorio del backend:
   ```bash
   cd Kordia_backend
   ```
2. Crea un entorno virtual e inst谩lalo:
   ```bash
   python -m venv venv
   source venv/bin/activate  # En Linux/Mac
   venv\Scripts\activate     # En Windows
   ```
3. Instala las dependencias:
   ```bash
   pip install -r requirements.txt
   ```
4. Inicia el servidor:
   ```bash
   python -m app.main
   ```
   *El backend correr谩 en `http://localhost:8000`*

---

##  Instalaci贸n con Docker (Windows, Linux, Mac)

Docker es la forma m谩s sencilla de ejecutar Kordia en cualquier sistema operativo.

1. Aseg煤rate de tener **Docker** y **Docker Compose** instalados.
2. Navega a la carpeta del proyecto y ejecuta:
   ```bash
   docker-compose -f docker/docker-compose.yml up -d
   ```
3. La aplicaci贸n estar谩 disponible en `https://tu-ip-local:8000`.

> [!IMPORTANT]
> Para que la PWA funcione correctamente en m贸viles, Docker utiliza **mkcert** para generar certificados SSL autom谩ticos. Aseg煤rate de configurar la variable `MKCERT_DOMAINS` en el `docker-compose.yml` con la IP local de tu PC.

---

##  Instalaci贸n PWA en M贸viles (Android / iOS)

Para que Kordia funcione como una aplicaci贸n nativa en tu m贸vil (PWA) y soporte descargas offline, sigue estos pasos:

### 1. Acceso seguro (HTTPS)
Las PWA requieren **HTTPS** por seguridad. 
- Si usas **Docker**: La aplicaci贸n ya sirve HTTPS en el puerto `8000`.
- Si usas la instalaci贸n **Manual**: Deber谩s usar un t煤nel (como Cloudflare Tunnel o Ngrok) o un proxy inverso (como Nginx) para habilitar HTTPS.

### 2. Pasos para instalar:
1. Desde tu m贸vil, abre el navegador (Chrome en Android, Safari en iOS).
2. Ingresa la direcci贸n IP de tu PC con HTTPS (ej: `https://192.168.1.XX:8000`).
3. **En Android (Chrome):** Toca los tres puntos `` y selecciona **"Instalar aplicaci贸n"** o **"Agregar a la pantalla de inicio"**.
4. **En iOS (Safari):** Toca el bot贸n de compartir `` y selecciona **"A帽adir a la pantalla de inicio"**.

### 3. Soluci贸n al error "Conexi贸n No Segura" (Muy Importante)
Incluso con HTTPS activado v铆a Docker, el m贸vil marcar谩 la conexi贸n como **"No Segura"** porque el certificado es de desarrollo (auto-firmado). Esto **bloquear谩 los Service Workers** y no podr谩s descargar m煤sica.

Tienes dos formas de solucionarlo:

#### Opci贸n A: Instalar el certificado en tu m贸vil (Recomendado)

Para que tu tel茅fono conf铆e en el HTTPS de tu PC y veas el "candado verde" sin advertencias, debes instalar el Certificado Ra铆z (Root CA) de mkcert en tu m贸vil.

Aqu铆 tienes los pasos detallados:

1. **Obt茅n el certificado ra铆z en tu PC**
   Primero, necesitas localizar el archivo del certificado que mkcert usa para firmar todos los dem谩s:
   ```bash
   # Ejecuta esto en tu terminal para ver d贸nde est谩 la carpeta
   mkcert -CAROOT
   ```
   *   **En Windows:** `%LocalAppData%\mkcert`
   *   **En Linux:** `~/.local/share/mkcert`
   *   **En Mac:** `~/Library/Application Support/mkcert`
   *   **Si usas Docker:** `docker cp kordia:/root/.local/share/mkcert/rootCA.pem ./rootCA.pem`

   Copia el archivo llamado `rootCA.pem` de esa carpeta a tu tel茅fono (puedes envi谩rtelo por Telegram, correo, o cable USB).

2. **Genera el certificado de Kordia con tu IP local**
   Para que el tel茅fono no d茅 error al entrar por la IP (ej. 192.168.1.50), el certificado debe incluir esa IP. Busca tu IP local con `ip addr` y luego regenera los archivos en `Kordia_backend/`:
   ```bash
   # Reemplaza 192.168.1.XX por tu IP real
   mkcert -cert-file cert.pem -key-file key.pem localhost 127.0.0.1 ::1 192.168.1.XX
   ```

3. **Instala el certificado en tu tel茅fono**
   - **En Android:**
     1. Ve a **Ajustes > Seguridad > Cifrado y credenciales** (o busca "certificados" en la lupa).
     2. Selecciona **Instalar desde el almacenamiento > Certificado de CA**.
     3. El sistema te dar谩 una advertencia (es normal, t煤 eres el due帽o del servidor). Pulsa **Instalar de todas formas**.
     4. Selecciona el archivo `rootCA.pem` que pasaste anteriormente.
   - **En iOS (iPhone):**
     1. Abre el archivo `rootCA.pem` y pulsa **Instalar perfil**.
     2. Ve a **Ajustes > Perfil descargado** e inst谩lalo.
     3. **Paso CRTICO en iOS:** Ve a **Ajustes > General > Informaci贸n > Ajustes de confianza de certificados**.
     4. Activa el interruptor de **mkcert development CA** para darle confianza total.

4. **Verifica y disfruta**
   Reinicia el backend de Kordia. Ahora, cuando entres desde el navegador de tu m贸vil a `https://<tu-ip>:8000`:
   - Ver谩s el **candado verde**.
   - Podr谩s instalar la PWA como si fuera una app nativa.
   - Todas las funciones Offline funcionar谩n correctamente.

隆Con esto ya tienes un entorno de desarrollo profesional en toda tu red local! ю

#### Opci贸n B: Bypass en Chrome (Solo Android/Desktop)
Si no quieres instalar cerficados, puedes forzar a Chrome a tratar tu IP como segura:
1. Abre `chrome://flags/#unsafely-treat-insecure-origin-as-secure` en Chrome.
2. Activa la opci贸n (**Enabled**).
3. En el cuadro de texto, pega la URL de tu app (ej: `https://192.168.1.XX:8000`).
4. Reinicia Chrome.

### 4. 隆Listo!
Ahora puedes abrir Kordia desde tu men煤 de aplicaciones, buscar canciones y darle al bot贸n de **descargar** para escucharlas sin internet.


---

## 锔 Configuraci贸n til (Variables de Entorno)

| Variable | Prop贸sito |
|----------|-----------|
| `CORS_ORIGINS` | Dominios que pueden acceder a la API (usa `*` para desarrollo). |
| `DATA_DIR` | Donde se guardan las canciones y la base de datos. |
| `MKCERT_DOMAINS` | IPs o dominios para los que se generar谩 el certificado SSL. |

---
*Hecho con わ para los amantes de la m煤sica.*